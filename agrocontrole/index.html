cd ~/agrocontrole/public
rm -rf *
nano index.html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AgroControle Pro</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{background:#111;color:#fff;font-family:Arial;padding:15px;}
h2{text-align:center;margin-bottom:5px;}
.card{background:#1e1e1e;padding:15px;border-radius:10px;margin-top:15px;}
input, select{width:100%;padding:8px;margin:5px 0;border:none;border-radius:6px;}
button{padding:10px;border:none;border-radius:6px;font-weight:bold;cursor:pointer;}
.full{width:100%;margin-top:5px;background:#ff9800;color:#fff;}
.flex{display:flex;gap:10px;flex-wrap:wrap;}
.delete{background:#e53935;width:45px;color:#fff;}
.total{font-size:18px;margin-top:10px;}
canvas{background:#fff;border-radius:10px;}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px;}
th,td{border:1px solid #444;padding:5px;text-align:center;}
th{background:#333;}
hr{margin:15px 0;border:1px solid #333;}
.hidden{display:none;}
.adminBtn {background:#2196F3;color:#fff;font-weight:bold;padding:10px;border:none;border-radius:6px;cursor:pointer;width:100%;margin-bottom:5px;}
</style>
</head>
<body>

<h2>üåæ AgroControle Pro</h2>

<!-- LOGIN -->
<div id="loginDiv">
  <button id="googleLogin" class="full">Entrar com Google</button>
</div>

<!-- SISTEMA -->
<div id="appDiv" class="hidden">
  <p>Bem-vindo, <span id="userName"></span></p>
  <button id="logoutBtn" class="full">Sair</button>
  <div id="adminButtons" class="hidden">
    <button class="adminBtn" id="userHistoryBtn">Hist√≥rico de Usu√°rios</button>
    <button class="adminBtn" id="backupBtn">Backup Fazendas</button>
  </div>

  <!-- Fazendas -->
  <div class="card" id="fazendaCard">
    <h3>üè° Fazendas</h3>
    <div class="flex">
      <select id="listaFazendas" style="flex:1"></select>
      <input type="text" id="novaFazenda" placeholder="Nova fazenda" style="flex:1;">
      <button class="full" onclick="criarNovaFazenda()">Criar Fazenda</button>
    </div>
    <div class="flex">
      <button class="delete" style="flex:1;" onclick="excluirFazenda()">Excluir Fazenda</button>
    </div>
  </div>

  <!-- Criar produto -->
  <div class="card">
    <label>Novo Produto</label>
    <input type="text" id="novoProduto">
    <button class="full" onclick="criarProduto()">Criar Produto</button>
  </div>

  <!-- Sele√ß√£o de produto e estoque -->
  <div class="card">
    <label>Selecionar Produto</label>
    <div class="flex">
      <select id="listaProdutos" style="flex:1" onchange="selecionarProduto()"></select>
      <button class="delete" onclick="excluirProduto()">X</button>
    </div>

    <label>Quantidade (Estoque)</label>
    <input type="number" id="quantidade" min="0">

    <div class="flex">
      <button style="flex:1" onclick="retirado()">Retirado Almoxarifado</button>
      <button style="flex:1" onclick="aplicado()">Aplicado na Lavoura</button>
    </div>

    <button class="full" onclick="desfazerEstoque()">Desfazer √öltima Movimenta√ß√£o Estoque</button>

    <hr>

    <label>Dose Aplicada</label>
    <input type="number" id="dose" oninput="calcularDose()" min="0">

    <label>√Årea Aplicada (hectare)</label>
    <input type="number" id="area" oninput="calcularDose()" min="0">

    <label>Quantidade por Hectare (autom√°tico)</label>
    <input type="number" id="hectare" readonly>

    <div class="flex">
      <button style="flex:1" onclick="registrarAplicacao()">Registrar Aplica√ß√£o</button>
      <button style="flex:1" onclick="desfazerAplicacao()">Desfazer √öltima Aplica√ß√£o</button>
    </div>
  </div>

  <div class="card">
    <div class="total">Estoque Atual: <span id="estoque">0.00</span></div>
    <div class="total">M√©dia por Hectare: <span id="media">0.00</span></div>
  </div>

  <div class="card">
    <h3 id="historicoTitulo">üìã Hist√≥rico</h3>
    <table>
      <thead>
        <tr>
          <th>Produto</th>
          <th>Tipo</th>
          <th>Qtd</th>
          <th>Dose</th>
          <th>√Årea</th>
          <th>Qtd/Ha</th>
          <th>Data</th>
          <th>Excluir</th>
        </tr>
      </thead>
      <tbody id="tabelaHistorico"></tbody>
    </table>
  </div>

  <div class="card">
    <h3 id="graficoTitulo">üìä Gr√°fico</h3>
    <canvas id="grafico"></canvas>
  </div>

</div>

<script>
// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDqgk71ZIeNxEHsyBQkWJjjYGkaunmkBEk",
  authDomain: "agrocontrolepro.firebaseapp.com",
  projectId: "agrocontrolepro",
  storageBucket: "agrocontrolepro.firebasestorage.app",
  messagingSenderId: "519100859803",
  appId: "1:519100859803:web:3c3ddc3b610d60df338d3e",
  measurementId: "G-1WQGZYFB89"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Admin email
const adminEmail = "bernardescl9@gmail.com";

// Vari√°veis de DOM
const loginDiv = document.getElementById("loginDiv");
const appDiv = document.getElementById("appDiv");
const googleLogin = document.getElementById("googleLogin");
const logoutBtn = document.getElementById("logoutBtn");
const userNameSpan = document.getElementById("userName");
const adminButtons = document.getElementById("adminButtons");
const backupBtn = document.getElementById("backupBtn");

// Login Google
googleLogin.onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).catch(console.error);
};

// Logout
logoutBtn.onclick = () => auth.signOut();

// Observa login
auth.onAuthStateChanged(user => {
  if(user){
    loginDiv.classList.add("hidden");
    appDiv.classList.remove("hidden");
    userNameSpan.textContent = user.displayName;
    if(user.email === adminEmail) adminButtons.classList.remove("hidden");
    else adminButtons.classList.add("hidden");
  }else{
    loginDiv.classList.remove("hidden");
    appDiv.classList.add("hidden");
  }
});

// --- Fun√ß√µes Fazendas / Produtos / Hist√≥rico (mesmo c√≥digo antigo)
let nomeFazenda = "";
let produtos = {};
let produtoAtual = null;
let chart = null;

function carregarListaFazendas(){
    const select = document.getElementById("listaFazendas");
    select.innerHTML='<option value="">--Selecione uma fazenda--</option>';
    for(let key in localStorage){
        if(key.startsWith("dadosFazenda_")){
            let nome=key.replace("dadosFazenda_","");
            const option=document.createElement("option");
            option.value=nome; option.text=nome;
            select.appendChild(option);
        }
    }
    if(nomeFazenda) select.value=nomeFazenda;
}

function criarNovaFazenda(){
    let input=document.getElementById("novaFazenda");
    let nome=input.value.trim();
    if(!nome){alert("Digite um nome v√°lido"); return;}
    nomeFazenda=nome;
    produtos={};
    salvar();
    carregarListaFazendas();
    document.getElementById("listaFazendas").value=nomeFazenda;
    input.value="";
    atualizarLista(); mostrar();
}

function salvar(){ if(!nomeFazenda) return; localStorage.setItem("dadosFazenda_"+nomeFazenda,JSON.stringify(produtos)); }

function atualizarLista(){
    const select=document.getElementById("listaProdutos"); select.innerHTML="";
    const nomes=Object.keys(produtos);
    if(nomes.length===0){produtoAtual=null; return;}
    nomes.forEach(nome=>{
        const option=document.createElement("option");
        option.value=nome; option.text=nome;
        select.appendChild(option);
    });
    produtoAtual=nomes[0]; select.value=produtoAtual;
    mostrar();
}

// --- Backup Fazendas atualizado ---
backupBtn.onclick = () => {
  let encontrou = false;
  for(let key in localStorage){
    if(key.startsWith("dadosFazenda_")){
      encontrou = true;
      let nome = key.replace("dadosFazenda_","");
      let dados = localStorage.getItem(key);
      if(dados){
        let blob = new Blob([dados], {type: "application/json"});
        let url = URL.createObjectURL(blob);
        let a = document.createElement("a");
        a.href = url;
        a.download = nome+"_backup.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
    }
  }
  if(!encontrou) alert("N√£o h√° fazendas para backup!");
};
</script>

</body>
</html>
